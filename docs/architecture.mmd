graph TB
    subgraph Sources["ğŸ“¡ RSS Sources"]
        RSS1[Tech Blogs]
        RSS2[News Sites]
        RSS3[Substacks]
        RSS4[Company Blogs]
    end

    subgraph Ingestion["ğŸ”„ Ingestion Layer"]
        Cron["â° Cron Trigger<br/>Every 4 hours"]
        FeedQueue["ğŸ“¥ Feed Fetch Queue<br/>briefings-feed-fetch"]
        Parser["ğŸ“ RSS Parser"]
    end

    subgraph Storage["ğŸ’¾ Storage Layer"]
        D1[("ğŸ“Š D1 Database<br/>SQLite")]
        KV["ğŸ”‘ KV Namespace<br/>Config"]
        R2["ğŸ“¦ R2 Bucket<br/>Historical Context"]
    end

    subgraph Processing["âš™ï¸ Processing Layer"]
        DailyInit["ğŸ“… Daily Summary<br/>Initiator Queue"]
        DailyProc["ğŸ¤– Daily Summary<br/>Processor Queue"]
        WeeklyQ["ğŸ“° Weekly Digest<br/>Queue"]
    end

    subgraph AI["ğŸ§  AI Services<br/>Google Gemini"]
        Flash["âš¡ Flash Model<br/>Daily Summaries<br/>Temp: 0.7"]
        Pro["ğŸ¯ Pro Model<br/>Weekly Digests<br/>Temp: 0.85"]
    end

    subgraph Output["ğŸ“¤ Output Layer"]
        Email["âœ‰ï¸ Resend<br/>Email Delivery"]
        API["ğŸ”Œ HTTP API<br/>Manual Triggers"]
    end

    subgraph Personalization["ğŸ‘¤ Personalization"]
        Profile["ğŸ“‹ profile.yaml<br/>Recipient Profile"]
        Prompts["ğŸ“ prompts.yaml<br/>AI Prompts"]
    end

    RSS1 --> FeedQueue
    RSS2 --> FeedQueue
    RSS3 --> FeedQueue
    RSS4 --> FeedQueue
    
    Cron --> FeedQueue
    FeedQueue --> Parser
    Parser --> D1
    
    D1 --> DailyInit
    DailyInit --> DailyProc
    DailyProc --> Flash
    Flash --> D1
    
    D1 --> WeeklyQ
    WeeklyQ --> Pro
    Pro --> R2
    R2 --> Email
    
    Profile --> Pro
    Prompts --> Flash
    Prompts --> Pro
    
    API --> FeedQueue
    API --> DailyInit
    API --> WeeklyQ
    
    KV -.-> Flash
    KV -.-> Pro

    style Sources fill:#e1f5fe
    style Ingestion fill:#fff3e0
    style Storage fill:#e8f5e9
    style Processing fill:#fce4ec
    style AI fill:#f3e5f5
    style Output fill:#fff8e1
    style Personalization fill:#e0f2f1
