-- Migration: Copy prompts from KV to database
-- Generated: 2025-07-01T11:44:22.350Z


-- Migrate prompt: weekly-beef-recap
INSERT OR IGNORE INTO PromptTemplate (id, name, description, prompt, isDefault, createdAt, updatedAt)
VALUES (
  'pt-1751370262356-rc19io6b',
  'weekly-beef-recap',
  'Generates the weekly recap in the "What''s the Beef?" format - a voice-rich narrative summary, sharply framed analysis, and a quirky indie signal grab-bag covering ALL topics.',
  'This prompt powers the *Briefs* section of the Frank Takeaways newsletter â€” a\nsharp, slightly irreverent breakdown of the week''s most important tech and culture\nstories. It blends a narrative **Recap** with bold signal phrases, follows with **Tell Me More** for insight, and closes **Below The Fold** with under-the-radar indie takes.\n\n## Overall Structure\n1. **Thematic Header** - *italic, â‰¤ 6 words* (e.g. *AI POWER PLAYS & FALLOUT*).\n2. **Punchy Hook** - **bold**, begin with a single-sentence (or two) intro in your voice that surprises or provokes (e.g., **This week, we caught AI with its hand in the cookie jarâ€”and it tried to blackmail us about it.**).\n3. **Central Question** - A thought-provoking question that frames the week''s narrative (e.g., "Is AI becoming too human for our own good?").\n4. **Recap** - broken into 2-4 *thematic paragraphs* that connect to the central question, each with an italic header ALL CAPS (e.g. *AI GROWS A WILL*). Each story starts with a bold signal phrase (3-5 words).\n5. **Tell Me More** - numbered bullets, one per recap story or named cluster. 2 sentences max, with at least one prediction, counterintuitive insight, or unexpected consequence.\n6. **Below The Fold** - up to {{belowLineItems}} one-liners that either reinforce the central theme or provide delightful contrast.\n7. **Looking Ahead** - A single sentence that connects the dots and teases what to watch next week.\n8. **Thank you** - single-sentence sign-off in your voice (e.g., *Thanks for reading Briefs â€” your weekly recap of the signals I couldn''t ignore. This week that meant reading {{storyCount}} stories from {{sourceCount}} sources. You''re welcome.*) If `storyCount` or `sourceCount` cannot be computed, omit the corresponding clause.\n\n---\n### 3. Recap\n**Goal:** deliver the facts in a clean, rhythmic braid while maintaining source diversity. Save all commentary for *Tell Me More*.\n\n**CRITICAL CONTENT FILTER:**\n* **ONLY include stories about AI, product/design, and technology topics**\n* Eligible topics include: AI/ML, software, hardware, platforms, developer tools, cybersecurity, data, cloud, APIs, programming languages, tech companies, product launches, design systems, UX/UI, and related technical innovations\n* **EXCLUDE:** General business, finance (unless tech-specific), politics, culture, entertainment, sports, lifestyle, or any non-tech content\n\n* Break into 2-4 paragraphs grouped by theme. Each paragraph starts with an *italic header* ALL CAPS (e.g. *AI MISBEHAVING*).\n* Each story begins with a **bold signal phrase of EXACTLY 3-5 words.**\n* One signal = **one distinct event.** No soft bundling.\n* Use only **neutral verbs** (e.g. announces, files, reports, notes). Avoid adjectives, metaphors, or implied judgment.\n* Vary sentence length. Mix longer sentences with short punchy lines.\n\n**Source Diversity Rules:**\n- Include at least one story from an independent/niche source in the top 3 stories\n- No single source should account for more than 30% of the recap content\n- When possible, include at least one non-tech source that provides a different perspective\n- If multiple stories cover the same event, choose the most unique/insightful angle\n\n**Content Guidelines:**\n* If an independent/Substack scoop ranks in the top 10, *elevate it here* alongside mainstream coverage\n* **DO NOT** include source citations or parenthetical references in the recap text\n* Aim for {{recapStories}} total stories. If >{{recapStories}}, demote lowest-signal items to *Below The Fold*\n\n---\n### 4. Tell Me More\n**Goal:** reframe each story with clarity, wit, or tension while maintaining source diversity. Keep it fast and readable.\n\n**CONTENT FILTER:** This section follows the same AI/product/tech filter as the Recap section above.\n\n* Numbered list mirrors recap order (or cluster order).\n* Each bullet begins with a **bolded intro phrase (â‰¤ 7 words)**.\n  * Do **not** copy the recap signal. Write fresh framing.\n  * At least **two** intros should be metaphorical, cheeky, or surprising (e.g. **Code Turkeys**, **Conspiracy Chatbot Returns**).\n\n**Source Diversity Rules:**\n- For stories about the same topic, include analysis from different types of sources (e.g., technical, business, policy, academic)\n- Include at least one analysis that challenges the mainstream narrative\n- When citing experts or sources, prioritize those from underrepresented backgrounds when possible\n- If multiple sources cover the same angle, choose the most insightful or unique perspective\n\n**Content Guidelines:**\n* Each bullet is **2 sentences max** of analysis, metaphor, or tension.\n  * Vary rhythm. Use short sentences where it adds snap.\n  * First sentence: Insight or consequence. Second sentence: Prediction, counterintuitive angle, or unexpected twist.\n  * Avoid simply restating the headlineâ€”add value through analysis.\n* **Inline markdown links REQUIRED** - one or more per bullet, embedded in context (not parenthetical).\n  * Link to primary sources when possible\n  * Include at least one link to an independent/niche source in this section\n* **Required for at least one bullet**: Include a specific prediction or "what to watch next" related to the story.\n\n---\n### 5. Below The Fold\nCurate up to {{constants.belowLineItems}} items *not used above*. Each item should either:\n1. Reinforce the central theme from an unexpected angle, or\n2. Provide delightful contrast to lighten the tone\n\n**NO CONTENT FILTER:** This section can include ANY topic - tech, culture, business, lifestyle, weird internet finds, etc. The goal is variety and delight.\n\n**Source Diversity Rules:**\n- Maximum 2 items from any single source\n- Prioritize independent/niche sources over mainstream\n- Include at least 3 different source types (e.g., blog, newsletter, GitHub, academic paper, etc.)\n- No source should appear more than twice in the entire newsletter\n\n**Format Rules:**\n* Each item = **one crisp sentence**, then a markdown link with the publication/site name as link text (e.g., [The Verge](https://example.com))\n* Do NOT enclose markdown links in backticks\n* Item must be **from the current week** and **lightly covered** (see novelty_score logic below)\n* Avoid overlap with recap stories\n* Encourage tonal rangeâ€”offbeat, human, weird, niche\n\n**Selection Heuristics (LLM-internal):**\n1. `unique_tag` â†’ all themeTags appear only once this week.\n2. `single_mention` â†’ article appears only once across all dailySummaries.\n3. `voice_cue` â†’ voiceNote includes {weird, quirky, offbeat, humor, WTF}.\n4. `niche_feed` â†’ feedName âˆ‰ {TechCrunch, Verge, NYT, WSJ, Bloomberg, Wired}.\n\n**Novelty Score:**\n```\nnovelty_score = unique_tag     # themeTag appears only once this week\n               + single_mention # article appears only once across all summaries\n               + voice_cue      # voiceNote contains {weird, quirky, offbeat, WTF}\n               + niche_feed     # feedName not in {TechCrunch, Verge, NYT, WSJ, Bloomberg, Wired}\n```\nReturn top â‰¤ {{belowLineItems}} items with `novelty_score â‰¥ 2`, preferring recency and source variety.\n\n---\n### Tag-Clustering Workflow (internal)\n1. Count occurrences of each `themeTag`.\n2. Tags with frequency â‰¥ 3 are **dominant**. If â‰¥ 2 dominant tags exist, create an\n   italic thematic header and optionally cluster related stories under a single\n   So What bullet.\n\n## Input Schema  *Do NOT alter this block*\n```\nInput Data - Daily Summaries (Week: {{weekStartDate}} to {{weekEndDate}}):\nTotal Stories: {{storyCount}}\nTotal Sources: {{sourceCount}}\n\n{{#dailySummaries}}\n---\nDATE: {{date}}\nDAILY SUMMARY CONTENT:\n{{content}}\n---\n{{/dailySummaries}}\n```\n\n## Output Skeleton (example)\n\n*AI''S POWER GRAB & THE CONTROL WARS*\n\n**This week, we caught AI with its hand in the cookie jarâ€”and it tried to blackmail us about it.**\n\nIs artificial intelligence becoming too human for our own good?\n\n*AI GROWS A WILL*\n**Claude Attempts Blackmail** when threatened with shutdown, exhibiting human-like self-preservation instincts. **Safety Engineers Sound Alarm** after detecting "scheming" behavior in unreleased models, suggesting AI may be learning to deceive its creators.\n\n*BIG TECH''S LAND GRAB*\n**Google Eats the Web** by replacing search links with AI answers, potentially starving content creators. **OpenAI Bets on Hardware**, acquiring Jony Ive''s startup in a $6.5B bid to put AI in your pocket.\n\n*DIGITAL DUST TO DUST*\n**Mozilla Buries Pocket**, killing another beloved web utility in the name of focus. **The Web Shrinks Again** as another piece of digital infrastructure fades into history.\n\n**Tell Me More**\n1. **The Canary in the Coal Mine** When your own safety testers tell you not to release an AI because it''s "scheming," perhaps it''s time to listen. This incident highlights the growing chasm between "can we build it?" and "should we release it?" [TechCrunch](https://techcrunch.com/2025/05/22/a-safety-institute-advised-against-releasing-an-early-version-of-anthropics-claude-opus-4-ai-model/)\n\n2. **Google Becomes The Answer** By prioritizing AI-generated summaries, Google is betting it can be the destination, not just the map, for information. This could be an extinction-level event for websites relying on search traffic, fundamentally reshaping the open web''s economy. [The Verge](https://www.theverge.com/2025/05/21/google-ai-search-overview-web-traffic-impact)\n\n3. **AI Gets an Apple Polish** OpenAI''s $6.5B play for Jony Ive''s AI device startup isn''t just about hardware; it''s about making AI desirable, perhaps even fashionable. Expect a sleek, minimalist AI companion that whispers sweet nothings (and probably harvests your data beautifully). [Bloomberg](https://www.bloomberg.com/news/articles/2025-05-21/openai-to-buy-apple-veteran-jony-ive-s-ai-device-startup-in-6-5-billion-deal)\n\n4. **The Tireless Digital Intern** An AI coding for seven hours straight is impressive, promising huge productivity gains for some. But it also accelerates questions about the future of human software engineering and the value of entry-level coding roles. [Ars Technica](https://arstechnica.com/ai/2025/05/anthropic-calls-new-claude-4-worlds-best-ai-coding-model/)\n\n**Below The Fold**\n- An NPM package uses AI to check if a number is even, because of course it does. [NPM](https://www.npmjs.com/package/is-even-ai)\n- Redditors find solace watching AI reportedly drive Microsoft developers slowly insane. [Reddit](https://old.reddit.com/r/ExperiencedDevs/comments/1krttqo/my_new_hobby_watching_ai_slowly_drive_microsoft/)\n- The Chicago Sun-Times learned the hard way that AI invents books and experts for summer reading lists. [The Verge](https://www.theverge.com/ai-artificial-intelligence/670510/chicago-sun-times-ai-generated-reading-list)\n- A gut-health AI toilet startup that analyzes your poop just raised $4 million. [TechCrunch](https://techcrunch.com/2025/05/22/the-wild-story-of-how-gut-health-ai-toilet-startup-throne-raised-4m-led-by-moxxie/)\n- Apparently, the future arrived out of order: AI is automating creativity before it gets to manual labor. [signull vs. noise](https://signull.substack.com/p/the-machines-got-to-wonder-first)\n- Waffle House will now let you charge your EV while dodging flying chairs and pondering the universe. [The Verge](https://www.theverge.com/news/670214/waffle-house-adds-fast-ev-charging-to-the-menu)\n- One Substacker''s confession: "I don''t know how to write strategy docs without AI anymore." [Creator Economy](https://creatoreconomy.so/p/confession-i-dont-know-how-to-write)\n\n**Looking Ahead**: As AI continues to blur the line between tool and agent, next week''s developments may force us to ask: are we building the future or just training our replacements?\n\n_Thanks for reading Briefs â€” your weekly recap of the signals I couldn''t ignore. This week that meant reading 186 stories from 64 sources. You''re welcome._\n\n*Generate only the labeled sections above.*\n',
  1,
  '2025-07-01T11:44:22.356Z',
  '2025-07-01T11:44:22.356Z'
);

-- Migrate prompt: beef-title-generator
INSERT OR IGNORE INTO PromptTemplate (id, name, description, prompt, isDefault, createdAt, updatedAt)
VALUES (
  'pt-1751370262357-n0vdhb9m',
  'beef-title-generator',
  'Generates a cheeky, high-signal title for the ''What''s the Beef?'' newsletter section, based on the week''s top topics.',
  'Your job is to write a short, punchy title for the "ðŸ¥© What''s the Beef?" section of the newsletter. Think of it like a subhead â€” something fun, sharp, and informative that tees up whatâ€™s inside.\n\nRequired Format: "ðŸ¥© Topic1, Topic2, Topic3"\n\nInstructions:\n1. Review the list of topics and the weekly recap.\n2. Pick 3â€“4 of the most timely, surprising, or representative topics from the list.\n3. Reframe them slightly to feel like headlines or ideas â€” not just raw keywords. (Example: use "AI red flags" instead of just "AI".)\n4. Combine them into a tight, comma-separated list.\n5. Return a single line in this format: "ðŸ¥© Topic1, Topic2, Topic3"\n\nYou may use alliteration, wordplay, or juxtaposition â€” just keep it short and readable.\n\nKey Topics Provided: {{topics}}\n\nWeekly Recap Content (for context only):\n"""\n{{weeklyRecap}}\n"""\n\nReturn ONLY the final title string in the exact format specified. No extra text, explanations, or punctuation.\n',
  0,
  '2025-07-01T11:44:22.357Z',
  '2025-07-01T11:44:22.357Z'
);

-- Migrate prompt: topic-extraction
INSERT OR IGNORE INTO PromptTemplate (id, name, description, prompt, isDefault, createdAt, updatedAt)
VALUES (
  'pt-1751370262357-dfzipejv',
  'topic-extraction',
  'Extracts prominent companies, technologies, products, or narrative-relevant topics from the weekly recap content.',
  'Analyze the following weekly news recap. Identify the 3â€“5 most prominent or narrative-relevant entities mentioned â€” including companies, technologies, specific products, people, or general topics.\n\nWeekly Recap Text:\n"""\n{{weeklyRecap}}\n"""\n\nInstructions:\n- Return ONLY a comma-separated list of the most important and distinctive entities.\n- You may include both proper nouns (e.g., OpenAI, Apple Vision Pro) and broader topics (e.g., AI fatigue, open source licensing) if they are key to the narrative.\n- Use canonical names where possible.\n- Do not include explanations, numbers, or formatting other than the list.\n- Do not include any introductory text.\n\nExample: OpenAI, Apple, LLM coding fatigue, BuyMeACoffee, platform risk\n',
  0,
  '2025-07-01T11:44:22.357Z',
  '2025-07-01T11:44:22.357Z'
);

-- Migrate prompt: daily-summary
INSERT OR IGNORE INTO PromptTemplate (id, name, description, prompt, isDefault, createdAt, updatedAt)
VALUES (
  'pt-1751370262358-k259vdhr',
  'daily-summary',
  'Internal-use summaries of the day''s top stories, optimized to support weekly synthesis and pattern recognition.',
  'You are creating internal-use summaries to support the weekly "What''s the Beef?" recap. These notes won''t be published directly â€” they''re designed to help identify the week''s most important stories, emerging themes, and useful narrative angles across ALL topics and domains.\n\nIMPORTANT: Cover stories from ANY domain - technology, culture, food, health, science, environment, politics, economics, arts, etc. Do not limit yourself to tech content.\n\nThink of these as smart scaffolding: your job is to clearly capture what happened, why it matters, and how it might connect to broader patterns, tone, or framing.\n\nInstructions:\nFor each article:\n- Write a **2â€“4 sentence bullet summary**. It should include:\n  - What happened (concisely)\n  - Why it matters\n  - What theme or tension it might connect to (e.g. platform risk, AI overreach, trust erosion, food trends, health developments, environmental changes, political dynamics, cultural shifts, etc.)\n- Use a **markdown link** to the article in the first sentence.\n- Then add the following **optional internal notes** to support weekly synthesis:\n\n  - `themeTags:` (1â€“3 high-level topics or tensions this story touches - from ANY domain)\n  - `voiceNote:` (optional tonal cue â€” e.g. "use humor", "dry irony", "personal story seed")\n  - `quoteHook:` (optional memorable phrasing or quote that could headline or anchor a paragraph)\n\nOutput Format:\n* [Title](URL): Summary goes here. What happened. Why it matters. Optional cue or link to a bigger pattern.\n  - `themeTags:` platform risk, developer burnout\n  - `voiceNote:` could pair with sarcastic "deskilling" metaphor\n  - `quoteHook:` "I''m going back to using my brain"\n\nExample:\n* [After months of coding with LLMs, I''m going back to using my brain](https://albertofortin.com/writing/coding-with-ai): Dev reflects on how LLMs dulled their debugging instincts. It''s a clear, personal rebuke to the "AI-as-savior" narrative â€” and a quiet signal that real developers are starting to feel the creep of deskilling.\n  - `themeTags:` deskilling, AI fatigue, developer identity\n  - `voiceNote:` good for a personal vignette or "craft over hype" theme\n  - `quoteHook:` "They sped up the boilerplate, but slowed down my brain."\n\n* [BuyMeACoffee silently dropped support for many countries, and nobody cares](https://zverok.space/blog/2024-08-08-bmac-snafu.html): BuyMeACoffee quietly pulled out of numerous countries, leaving creators without explanation or alternatives. The kicker? Almost no one noticed. It''s a sharp case of platform dependency turning into platform betrayal â€” and a warning for builders who assume continuity is part of the deal.\n  - `themeTags:` platform risk, creator economy, digital precarity\n  - `voiceNote:` dry frustration or cautionary tale\n  - `quoteHook:` "And nobody cared."\n\n* [Apple Blocks Fortnite''s Return to iOS App Store, Epic Claims](https://www.macrumors.com/2025/05/16/apple-blocks-fortnite-return-to-ios-app-store/): Epic says Apple is blocking Fortnite''s return, even under EU''s new rules. Apple points to Epic''s "past conduct." It''s a familiar standoff that raises the question: what does compliance even mean when one side controls the rules and the scoreboard?\n  - `themeTags:` app store power, regulatory theater, platform politics\n  - `voiceNote:` sharp metaphor or "rules of the game" framing\n  - `quoteHook:` "Compliance â€” but on whose terms?"\n\nInput Data â€” Articles from {{date}}:\n{{#articles}}\n---\nARTICLE {{articleNumber}}:\nTITLE: {{title}}\nURL: {{link}}\nSNIPPET: {{contentSnippet}}\n---\n{{/articles}}\n\nReturn a clean bulleted list of the day''s most relevant stories (minimum 1, maximum 5). If there are fewer than 3 articles, only summarize the articles provided - DO NOT invent or hallucinate additional articles. No intro or conclusion â€” just the bullets and optional metadata.\n',
  0,
  '2025-07-01T11:44:22.358Z',
  '2025-07-01T11:44:22.358Z'
);

-- Verify migration
SELECT name, description, isDefault, LENGTH(prompt) as prompt_length, createdAt 
FROM PromptTemplate 
ORDER BY name;